<h1>Pacientes: Cl√≠nico</h1>
<hr>
<mat-accordion multi>
	<mat-expansion-panel>
		<mat-expansion-panel-header>
			<mat-panel-title>
				<span class="material-icons">
					person_add
				</span>
				Adicionar Paciente
			</mat-panel-title>
		</mat-expansion-panel-header>

		<form [formGroup]="newPatientForm" (ngSubmit)="addNewPatient()">
			<div fxLayout="row" fxLayoutGap="16px">
				<div fxFlex>
					<mat-form-field>
						<mat-label>Nome Completo</mat-label>
						<input matInput formControlName="name" maxlength="40">
					</mat-form-field>
				</div>
				<div fxFlex>
					<mat-form-field>
						<mat-label>Data de nascimento</mat-label>
						<input matInput appMask="00/00/0000" [matDatepicker]="picker" formControlName="birthday">
						<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
						<mat-datepicker #picker></mat-datepicker>
					</mat-form-field>
				</div>
				<div fxFlex>
					<mat-form-field>
						<mat-label>RG</mat-label>
						<input matInput appMask="0.000.000" formControlName="rg">
					</mat-form-field>
				</div>
				<div fxFlex>
					<mat-form-field>
						<mat-label>CPF</mat-label>
						<input appMask="000.000.000-00" matInput formControlName="cpf">
					</mat-form-field>
				</div>
			</div>

			<div fxLayout="row" fxLayoutGap="16px">
				<div fxLayout="column" fxFlex="25" fxLayoutGap="0px" formArrayName="phones">
					<h3>Telefones:</h3>
					<div *ngFor="let phones of phonesControl.controls; let i = index;">
						<mat-form-field>
							<mat-label>Telefone {{ i + 1 }}</mat-label>
							<input matInput appMask="(00) 00000-0000" [formControlName]="i">
							<button *ngIf="phonesControl.controls.length > 1" type="button" mat-icon-button matSuffix
								(click)="removePhone(i)">
								<mat-icon>remove</mat-icon>
							</button>
							<button type="button" mat-icon-button matSuffix (click)="addPhone()">
								<mat-icon>add</mat-icon>
							</button>
						</mat-form-field>
					</div>
				</div>
			</div>

			<button mat-flat-button color="primary" [disabled]="newPatientForm.invalid">Adicionar</button>
		</form>
	</mat-expansion-panel>
	<mat-expansion-panel expanded="true">
		<mat-expansion-panel-header>
			<mat-panel-title>
				<span class="material-icons">
					person_search
				</span>
				Procurar Pacientes
			</mat-panel-title>
		</mat-expansion-panel-header>

		<form [formGroup]="findPatientsForm" (ngSubmit)="getPatients()">
			<div fxLayout="row" fxLayoutGap="16px">
				<div fxFlex>
					<mat-form-field>
						<mat-label>Nome</mat-label>
						<input matInput formControlName="name" maxlength="40">
					</mat-form-field>
				</div>
				<div fxFlex>
					<mat-form-field>
						<mat-label>Data de nascimento</mat-label>
						<input matInput [matDatepicker]="picker2" formControlName="birthday">
						<mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
						<mat-datepicker #picker2></mat-datepicker>
					</mat-form-field>
				</div>
				<div fxFlex>
					<mat-form-field>
						<mat-label>RG</mat-label>
						<input matInput formControlName="rg">
					</mat-form-field>
				</div>
				<div fxFlex>
					<mat-form-field>
						<mat-label>Ficha</mat-label>
						<input matInput formControlName="card">
					</mat-form-field>
				</div>
			</div>

			<button mat-flat-button color="primary" [disabled]="findPatientsForm.invalid">Procurar</button>
		</form>

		<div class="mat-elevation-z8">
			<div class="table-container">
				<table mat-table [dataSource]="dataSource" multiTemplateDataRows>
					<ng-container matColumnDef="card">
						<th mat-header-cell *matHeaderCellDef>Ficha</th>
						<td mat-cell *matCellDef="let row">{{row.card}}</td>
					</ng-container>

					<ng-container matColumnDef="name">
						<th mat-header-cell *matHeaderCellDef>Nome</th>
						<td mat-cell *matCellDef="let row">{{row.name}}</td>
					</ng-container>

					<ng-container matColumnDef="birthday">
						<th mat-header-cell *matHeaderCellDef>Data de Nasc.</th>
						<td mat-cell *matCellDef="let row">{{row.birthday ? (row.birthday | date) : '' }}</td>
					</ng-container>

					<ng-container matColumnDef="rg">
						<th mat-header-cell *matHeaderCellDef>RG</th>
						<td mat-cell *matCellDef="let row">{{ row.rg | rg }}</td>
					</ng-container>

					<ng-container matColumnDef="cpf">
						<th mat-header-cell *matHeaderCellDef>CPF</th>
						<td mat-cell *matCellDef="let row">{{ row.cpf | cpf }}</td>
					</ng-container>

					<ng-container matColumnDef="expandedDetail">
						<td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
							<div class="patient-detail"
								[@detailExpand]="element == expandedPatient ? 'expanded' : 'collapsed'">
								Conteudo
							</div>
						</td>
					</ng-container>

					<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
					<tr mat-row *matRowDef="let row; columns: displayedColumns;" class="example-element-row"
						[class.example-expanded-row]="expandedPatient === row"
						(click)="expandedPatient = (expandedPatient === row ? null : row)"></tr>
					<tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
				</table>
			</div>

			<mat-paginator [pageSizeOptions]="[10, 25, 100]"></mat-paginator>
		</div>
	</mat-expansion-panel>
</mat-accordion>
